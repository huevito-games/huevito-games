<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Mi página con autocierre</title>
  <script>
  (() => {
    const KEY = "TAB_UNICA_JS";
    const ID = Date.now() + Math.random();

    // 1️⃣ Control de pestaña única
    addEventListener("storage", e => {
      if (e.key === KEY && e.newValue != ID) {
        // Aviso de cierre detectado
        alert("Se ha detectado que hay otra pestaña activa. Esta pestaña se va a cerrar o bloquear.");
        // Intento de cierre
        try {
          window.close();
          // Si no se puede cerrar, redirigimos a página en blanco
          setTimeout(() => location.replace("about:blank"), 500);
        } catch (err) {
          location.replace("about:blank");
        }
      }
    });

    // 2️⃣ Registrar esta pestaña como activa
    const ping = () => localStorage.setItem(KEY, ID);
    ping();

    // 3️⃣ Ejecutar periódicamente para reforzar
    setInterval(ping, 1000);

    // 4️⃣ Detectar si la pestaña fue abierta manualmente
    if (!window.opener && !sessionStorage.getItem("jsOpened")) {
      sessionStorage.setItem("jsOpened", 1);
      // Recarga para activar la lógica correctamente
      location.reload();
      return;
    }
  })();
  </script>
</head>

<body>
  <!-- AQUÍ VA TU WEB NORMAL -->
  <h1>Mi página web</h1>
  <p>Contenido normal, scripts y estilos.</p>
</body>
</html>
