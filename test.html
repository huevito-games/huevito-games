<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Control de única pestaña</title>

<script>
(function() {

    const PAGE_KEY = "pagina_unica_abierta";
    const tabId = Date.now() + "_" + Math.random();
    const REDIRECT_URL = "https://huevito-games.github.io/autoclose/";

    // Función que redirige abriendo con JS y luego intenta cerrar
    function redirectAndClose() {
        // Abrir la URL con JavaScript
        window.open(REDIRECT_URL, "_self");

        // Intentar cerrar esta pestaña
        window.close();

        // Fallback si el navegador bloquea el cierre
        setTimeout(function(){
            document.body.innerHTML = "";
        }, 50);
    }

    // Si ya hay una pestaña registrada
    if (localStorage.getItem(PAGE_KEY)) {
        redirectAndClose();
        return;
    }

    // Registrar esta pestaña como activa
    localStorage.setItem(PAGE_KEY, tabId);

    // Escuchar si otra pestaña toma el control
    window.addEventListener("storage", function(event) {
        if (event.key === PAGE_KEY && event.newValue !== tabId) {
            redirectAndClose();
        }
    });

    // Liberar bloqueo al cerrar
    window.addEventListener("beforeunload", function() {
        if (localStorage.getItem(PAGE_KEY) === tabId) {
            localStorage.removeItem(PAGE_KEY);
        }
    });

})();
</script>

</head>
<body>
<h1>Solo puede haber una pestaña abierta</h1>
</body>
</html>
